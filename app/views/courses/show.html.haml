- content_for :breadcrumb do
  = link_to 'コース一覧', courses_path, class: 'section'
  %i.icon.right.angle.divider
  = @course.title


%h1= @course.title

.ui.small.horizontal.list
  .item
    %i.icon.book
    登録数：
    = @course.course_books.count
    冊

%div= simple_format_with_link @course.description


%br
.ui.horizontal.divider
  %i.icon.mail.outline
  配信状況

.ui.basic.center.aligned.segment
  - if @subscription
    .ui.secondary.center.aligned.segment
      - next_delivery = @subscription.next_delivery
      .ui.label 次回配信
      .ui.large.header
        - if @subscription.active?
          = @subscription.next_deliver_at.strftime('%m月%d日 %H:%M')
        - else
          （なし）
        - if next_delivery && next_delivery.book
          .sub.header
            #{next_delivery.book.author}『#{next_delivery.book.title}』
            %br
            （#{next_delivery.index} / #{ @subscription.delivery_count(next_delivery.book_id) }）

    %div
      - if @subscription.active?
        = link_to skip_subscription_path(@subscription), method: 'post', class: 'ui blue basic icon small button', 'data-tooltip'=>'スキップ', 'data-inverted'=>'', data: {confirm: '現在の本をスキップして次の本を配信します。本当によろしいですか？'} do
          %i.icon.fast.forward
          スキップ
        = link_to subscription_path(id: @subscription.id, status: 2), method: 'put', class: 'ui red basic icon small button', 'data-tooltip'=>'一時停止', 'data-inverted'=>'' do
          %i.icon.pause
          一時停止
      - if @subscription.paused?
        = link_to subscription_path(id: @subscription.id, status: 1), method: :put, class: 'ui blue basic icon small button', 'data-tooltip'=>'再開', 'data-inverted'=>'' do
          %i.icon.play
          配信再開
      - if @subscription.finished?
        %p このコースの配信は完了しました。もう一度読みたい場合は、一度購読を解除してから再度購読してください。
      = link_to subscription_path(@subscription), method: 'delete', class: 'ui black basic icon small button', 'data-tooltip'=>'購読解除', 'data-inverted'=>'', data: {confirm: '購読を解除します。本当によろしいですか？'} do
        %i.icon.trash
        購読解除

      / TMP
      - if @subscription.active?
        %br
        %br
        %br
        %div
          = link_to 'いますぐ配信', deliver_subscription_path(@subscription), method: 'post', class: 'ui red button'
  - else
    = link_to 'このコースを購読する', subscriptions_path(course_id: @course.id), method: :post, class: 'ui red button'


- if @subscription
  %br
  .ui.divider

  .ui.middle.alligned.divided.relaxed.large.ordered.list
    - @subscription.delivered_course_books.each do |course_book|
      - book = course_book.book
      .item
        .right.floated.content
          - if @subscription.next_delivery
            #{@subscription.next_delivery.index - 1} / #{ @subscription.delivery_count(next_delivery.book_id) }
        .content
          .header
            = book.title
            - if !@subscription.finished? && course_book.index == @subscription.next_book_index - 1
              %span.ui.mini.orange.label 配信中
            - else
              %span.ui.mini.label 配信済
          %small.description
            = book.author
