- content_for :breadcrumb do
  購読チャネル

%h1.ui.huge.header
  %i.icon.rss
  購読中のチャネル

- if !current_user
  .ui.warning.message
    %i.icon.warning.circle
    「チャネル」に読みたい本を追加して本を配信できます。
    利用には
    = link_to 'ログイン', login_path
    が必要です。

  .ui.stackable.grid
    .ui.three.columns.row
      - 3.times do |i|
        .ui.column
          .ui.placeholder.segment
            .ui.icon.header
              %i.grey.icon.rss
            = link_to 'チャネルを作成する', new_channel_path, class: 'ui primary small button'

- else
  .ui.info.message
    「チャネル」に読みたい本を追加して配信を開始しましょう。チャネルは3つまで購読できます。

  .ui.stackable.grid
    .ui.three.columns.row
      - @draft_channels.each do |channel|
        .ui.column
          .ui.fluid.card
            .content
              .header
                = link_to channel.title, channel_path(channel.token)
                - if !channel.public?
                  %small(data-tooltip="非公開" data-inverted="true")
                    %i.small.lock.icon
              .description
                = channel.description
            .extra.content
              - if channel.books_count == 0
                .ui.warning.message
                  .content
                    まだ本が登録されていないようです。「作品検索」で本を追加して配信開始しましょう！
              - else
                .ui.small.list
                  .item
                    %i.icon.book
                    #{channel.books_count}冊
            .extra.content
              - startable = channel.books_count > 0 ? '' : 'disabled'
              = link_to '配信開始', subscriptions_path(channel_id: channel.token), method: :post, class: "ui small red button #{startable}"
              = link_to '編集', edit_channel_path(channel.token), class: "ui primary small basic button"
              = link_to channel_path(channel.token), method: :delete, class: 'ui basic small icon right floated button', data: {confirm: 'チャネルを削除します。本当によろしいですか？'} do
                %i.icon.trash

      - @subscriptions.each do |subscription|
        .ui.column
          - channel = subscription.channel
          .ui.fluid.card
            .content
              .header
                = link_to channel.title, channel_path(channel.token)
                - if !channel.public?
                  %small(data-tooltip="非公開" data-inverted="true")
                    %i.small.lock.icon
              .description
                - if subscription.next_deliver_at
                  %span.ui.orange.mini.label 配信中
                = channel.description
            .extra.content
              - if channel.books_count == 0
                .ui.warning.message
                  .content
                    まだ本が登録されていないようです。「編集」ボタンから本を追加して配信開始しましょう！
              - else
                .ui.small.list
                  .item
                    %i.icon.book
                    #{channel.books_count}冊
                  .item
                    %i.icon.podcast
                    - if subscription.current_chapter
                      = "#{subscription.current_chapter.book.author}『#{subscription.current_chapter.book.title}』"
                      = "##{subscription.current_chapter.index}（全#{subscription.current_chapter.book.chapters_count}回）"
                  .item
                    %i.icon.clock.outline
                    #{subscription.delivery_hour}:00
            .extra.content
              - if !subscription.next_chapter_id
                - startable = channel.books_count > 0 ? '' : 'disabled'
                = link_to '配信開始', start_subscription_path(subscription), method: 'post', class: "ui red small button #{startable}"
              = link_to '編集', edit_channel_path(channel.token), class: "ui primary small button"
              = link_to channel_path(channel.token), method: :delete, class: 'ui basic small icon right floated button', data: {confirm: 'チャネルを削除します。本当によろしいですか？'} do
                %i.icon.trash

      .ui.column
        .ui.placeholder.segment
          .ui.icon.header
            %i.grey.icon.rss
            = link_to 'チャネルを作成する', new_channel_path, class: 'ui primary small button'
            -# .ui.horizontal.divider OR
            -# = link_to '公開チャネルを購読する', channels_path, class: 'ui small button'
