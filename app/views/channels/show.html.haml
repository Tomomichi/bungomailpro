%h1.ui.huge.header
  = @channel.title
  = channel_status_icon(@channel.status)

%div
  -# 購読管理
  - if @subscription && owned_channel?(@channel)
    = link_to '配信設定', edit_subscription_path(@subscription), class: 'ui red basic small button'
  - else
    - if @channel.books_count > 0 && current_user.try(:subscriptionable?)
      = link_to '配信開始', subscriptions_path(channel_id: @channel), method: :post, class: "ui small red button"
    - else
      %button.ui.small.red.disabled.button 配信開始

  -# ownerの場合は管理メニュー表示
  - if owned_channel?(@channel)
    = link_to 'チャネルの編集', edit_channel_path(@channel), class: 'ui primary basic small button', data: {turbolinks: false}

- if !@subscription && !current_user.try(:subscriptionable?)
  .ui.warning.small.message
    .content
      %i.icon.warning.circle
      購読チャネル数の上限に達しています。新しく購読したい場合は他の配信中チャネルの購読を解除してください。
%br

- if @channel.streaming?
  .ui.info.message
    .header
      %i.icon.rss
      このチャネルは「ストリーミング配信」です
    .content
      購読者全員に同じペースで配信され、みんなで同時に読書を楽しむチャネルです。


%div= simple_format_with_link @channel.description


- if @subscription
  - if @subscription.finished?
    .ui.warning.small.message
      %i.icon.warning.circle
      このチャネルの配信は終了しました。もう一度購読したい場合は、「配信設定」から一度購読を解除し、再度購読し直してください。

  .ui.small.header
    %i.icon.podcast
    配信中のタイトル
  .ui.secondary.padded.segment
    - if book = @subscription.current_chapter.try(:book)
      .ui.small.header
        #{book.author}『#{book.title}』
        = link_to book.aozora_card_url do
          %i.icon.mini.external
      %span.ui.label 次の配信
      第#{@subscription.current_chapter.index}回（全#{book.chapters_count}回）
      %i.icon.clock.outline
      = @subscription.next_deliver_at.strftime("%m月%d日 %H:%M")
    - else
      現在配信中のタイトルはありません
    .ui.hidden.divider
    %div
      %i.icon.rss
      = link_to subscription_path(@subscription, format: :atom), target: '_blank' do
        = subscription_url(@subscription, format: :atom)
        &nbsp;
        %i.icon.small.external

  .ui.secondary.pointing.menu
    - if @finished
      = link_to '今後の配信予定', channel_path(@channel), class: 'item'
      .active.item 過去の配信
    - else
      .active.item 今後の配信予定
      = link_to '過去の配信', channel_path(@channel, books: 'finished'), class: 'item'
- else
  .ui.small.dividing.header
    %i.icon.book
    配信タイトル

.ui.middle.alligned.relaxed.large.ordered.list
  - @books.each do |book|
    .item
      .content
        .header
          = book.title
          = link_to book.aozora_card_url, target: '_blank' do
            %i.icon.mini.external
          = delivery_period_label(book.chapters_count)
        .meta
          %small= book.author

- if @books.blank?
  - message = @finished ? 'まだ配信済みの本がないようです。' : '配信予定の本がありません。'
  %small= message
